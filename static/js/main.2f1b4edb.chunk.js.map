{"version":3,"sources":["assets/template.jpg","App.js","index.js"],"names":["module","exports","__webpack_require__","p","App","_useState","useState","_useState2","Object","slicedToArray","name","setName","_useState3","_useState4","subject","setSubject","_useState5","_useState6","status","setStatus","react_default","a","createElement","vkui","activePanel","popout","id","style","background","title","color","state","top","value","onChange","e","currentTarget","length","vertical","margin","paddingRight","size","onClick","callback","canvas","document","width","height","ctx","getContext","textAlign","fillStyle","Image","onload","drawImage","font","fillText","toDataURL","src","require","generateStory","story","connect","send","app_id","scope","then","response","access_token","data","method","params","add_to_news","link_text","link_url","v","uploadUrl","upload_url","request","FormData","append","dataurl","filename","arr","split","mime","match","bstr","atob","n","u8arr","Uint8Array","charCodeAt","File","type","dataURLtoFile","fetch","body","r","json","error","catch","console","ReactDOM","render","src_App","getElementById"],"mappings":"mHAAAA,EAAAC,QAAiBC,EAAAC,EAAuB,2IC+HzBC,EA5FH,WAAM,IAAAC,EACSC,mBAAS,IADlBC,EAAAC,OAAAC,EAAA,EAAAD,CAAAH,EAAA,GACTK,EADSH,EAAA,GACHI,EADGJ,EAAA,GAAAK,EAEeN,mBAAS,IAFxBO,EAAAL,OAAAC,EAAA,EAAAD,CAAAI,EAAA,GAETE,EAFSD,EAAA,GAEAE,EAFAF,EAAA,GAAAG,EAGaV,mBAAS,QAHtBW,EAAAT,OAAAC,EAAA,EAAAD,CAAAQ,EAAA,GAGTE,EAHSD,EAAA,GAGDE,EAHCF,EAAA,GAKjB,OACCG,EAAAC,EAAAC,cAACC,EAAA,KAAD,CAAMC,YAAY,OAAOC,OAAmB,WAAXP,EAAsBE,EAAAC,EAAAC,cAACC,EAAA,cAAD,MAAkB,MACxEH,EAAAC,EAAAC,cAACC,EAAA,MAAD,CAAOG,GAAG,QACTN,EAAAC,EAAAC,cAACC,EAAA,YAAD,4BACAH,EAAAC,EAAAC,cAACC,EAAA,WAAD,CAAYI,MAAO,CAAEC,WAAY,UAEpB,WAAXV,EACAE,EAAAC,EAAAC,cAACC,EAAA,WAAD,CAAYM,MAAM,sBAAOF,MAAO,CAACC,WAAY,UAAWE,MAAO,UAA/D,8JAEgB,KAGL,iBAAXZ,EACCE,EAAAC,EAAAC,cAACC,EAAA,WAAD,CAAYM,MAAM,wBAASE,MAAM,SAAjC,gTAEgB,KAGN,UAAXb,EACCE,EAAAC,EAAAC,cAACC,EAAA,WAAD,CAAYM,MAAM,wCAAUE,MAAM,SAAlC,qKAEgB,KAElBX,EAAAC,EAAAC,cAACC,EAAA,MAAD,CACCS,IAAI,6GACJC,MAAOvB,EACPwB,SAAU,SAACC,GAAD,OAAOxB,EAAQwB,EAAEC,cAAcH,MAAMI,QAAU,GAAKF,EAAEC,cAAcH,MAAQvB,MAEvFU,EAAAC,EAAAC,cAACC,EAAA,MAAD,CACCS,IAAI,yHACJC,MAAOnB,EACPoB,SAAU,SAACC,GAAD,OAAOpB,EAAWoB,EAAEC,cAAcH,MAAMI,QAAU,GAAKF,EAAEC,cAAcH,MAAQnB,OAG3FM,EAAAC,EAAAC,cAACC,EAAA,YAAD,CAAae,SAAS,SAASX,MAAO,CAAEY,OAAQ,GAAIC,aAAc,KACjEpB,EAAAC,EAAAC,cAACC,EAAA,OAAD,CACCkB,KAAK,KACLC,QAAS,WACRvB,EAAU,UA1EK,SAACT,EAAMI,EAAS6B,GACrC,IAAMC,EAASC,SAASvB,cAAc,UACtCsB,EAAOE,MAAQ,KACfF,EAAOG,OAAS,KAEhB,IAAMC,EAAMJ,EAAOK,WAAW,MAE9BD,EAAIE,UAAY,SAChBF,EAAIG,UAAY,UAEhB,IAAMvB,EAAa,IAAIwB,MACvBxB,EAAWyB,OAAS,WACnBL,EAAIM,UAAU1B,EAAY,EAAG,GAC7BoB,EAAIO,KAAO,mBACXP,EAAIQ,SAAS9C,EAAM,IAAK,MACxBsC,EAAIO,KAAO,aACXP,EAAIQ,SAAS1C,EAAS,IAAK,MAC3B6B,EAASC,EAAOa,cAEjB7B,EAAW8B,IAAMC,EAAQ,KAwDnBC,CAAclD,EAAMI,EAAS,SAAC+C,GAC7BC,IAAQC,KAAK,uBAAwB,CAAEC,OAAQ,QAASC,MAAO,YAC7DC,KAAK,SAACC,GACN,IAAMC,EAAeD,EAASE,KAAKD,aACnCN,IAAQC,KAAK,wBAAyB,CACrCO,OAAQ,+BACRC,OAAQ,CACPH,eACAI,YAAa,EACbC,UAAW,OACXC,SAAU,4BACVC,EAAG,UAGHT,KAAK,SAACC,GACN,IAAMS,EAAYT,EAASE,KAAKF,SAASU,WAEnCC,EAAU,IAAIC,SACpBD,EAAQE,OAAO,OAvEL,SAACC,EAASC,GAG/B,IAFA,IAAIC,EAAMF,EAAQG,MAAM,KAAMC,EAAOF,EAAI,GAAGG,MAAM,WAAW,GAC5DC,EAAOC,KAAKL,EAAI,IAAKM,EAAIF,EAAKlD,OAAQqD,EAAQ,IAAIC,WAAWF,GACxDA,KACLC,EAAMD,GAAKF,EAAKK,WAAWH,GAE5B,OAAO,IAAII,KAAK,CAACH,GAAQR,EAAU,CAACY,KAAKT,IAiEPU,CAAclC,EAAO,cAE5CmC,MAAM,uCAAyCpB,EAAW,CACzDN,OAAQ,OACR2B,KAAMnB,IAELZ,KAAK,SAAAgC,GAAC,OAAIA,EAAEC,SACZjC,KAAK,SAAAgC,GAAC,OAAIA,EAAEE,MAAQjF,EAAU,SAAWA,EAAU,YACnDkF,MAAMC,QAAQF,SAEhBC,MAAMC,QAAQF,SAEhBC,MAAM,kBAAMlF,EAAU,sBAlC3B,mHA0CDC,EAAAC,EAAAC,cAACC,EAAA,MAAD,KACQH,EAAAC,EAAAC,cAACC,EAAA,IAAD,mCC9GZuC,IAAQC,KAAK,eAAgB,IAE7BwC,IAASC,OAAOpF,EAAAC,EAAAC,cAACmF,EAAD,MAAS5D,SAAS6D,eAAe","file":"static/js/main.2f1b4edb.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/template.a88b486e.jpg\";","import React, { useState } from 'react';\nimport connect from \"@vkontakte/vkui-connect-promise\";\nimport { View, Panel, Div, PanelHeader, Input, Group, FormLayout, FixedLayout, Button, ScreenSpinner, FormStatus } from '@vkontakte/vkui';\n\nconst generateStory = (name, subject, callback) => {\n\tconst canvas = document.createElement(\"canvas\");\n\tcanvas.width = 1080;\n\tcanvas.height = 1920;\n\n\tconst ctx = canvas.getContext(\"2d\");\n\n\tctx.textAlign = \"center\";\n\tctx.fillStyle = \"#FFFFFF\";\n\n\tconst background = new Image();\n\tbackground.onload = () => {\n\t\tctx.drawImage(background, 0, 0);\n\t\tctx.font = \"96px Arial Black\";\n\t\tctx.fillText(name, 540, 1133);\n\t\tctx.font = \"68px Arial\";\n\t\tctx.fillText(subject, 540, 1494);\n\t\tcallback(canvas.toDataURL());\n\t};\n\tbackground.src = require(\"./assets/template.jpg\");\n};\n\nconst dataURLtoFile = (dataurl, filename) => {\n\tlet arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],\n\t\tbstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);\n\twhile(n--){\n\t\tu8arr[n] = bstr.charCodeAt(n);\n\t}\n\treturn new File([u8arr], filename, {type:mime});\n};\n\nconst App = () => {\n\tconst [ name, setName ] = useState(\"\");\n\tconst [ subject, setSubject ] = useState(\"\");\n\tconst [ status, setStatus ] = useState(\"none\");\n\n\treturn (\n\t\t<View activePanel=\"home\" popout={status === \"making\" ? <ScreenSpinner/>: null}>\n\t\t\t<Panel id=\"home\">\n\t\t\t\t<PanelHeader>Кто?</PanelHeader>\n\t\t\t\t<FormLayout style={{ background: \"white\" }}>\n\t\t\t\t\t{\n\t\t\t\t\t\tstatus === \"shared\" ?\n\t\t\t\t\t\t<FormStatus title=\"Ура!\" style={{background: '#528bcc', color: 'white'}}>\n\t\t\t\t\t\t\tМы опубликовали твою историю!\n\t\t\t\t\t\t</FormStatus> : null\n\t\t\t\t\t}\n\t\t\t\t\t{\n\t\t\t\t\t\tstatus === \"sharingError\" ?\n\t\t\t\t\t\t\t<FormStatus title=\"Упс...\" state=\"error\">\n\t\t\t\t\t\t\t\tМы не смогли получить твой токен, чтобы загрузить историю...\n\t\t\t\t\t\t\t</FormStatus> : null\n\t\t\t\t\t}\n\t\t\t\t\t{\n\t\t\t\t\t\tstatus === \"error\" ?\n\t\t\t\t\t\t\t<FormStatus title=\"Ошибка!\" state=\"error\">\n\t\t\t\t\t\t\t\tПроизошла неизвестная ошибка...\n\t\t\t\t\t\t\t</FormStatus> : null\n\t\t\t\t\t}\n\t\t\t\t\t<Input\n\t\t\t\t\t\ttop=\"Имя того, кто получит\"\n\t\t\t\t\t\tvalue={name}\n\t\t\t\t\t\tonChange={(e) => setName(e.currentTarget.value.length <= 16 ? e.currentTarget.value : name)}\n\t\t\t\t\t/>\n\t\t\t\t\t<Input\n\t\t\t\t\t\ttop=\"То, что получит человек\"\n\t\t\t\t\t\tvalue={subject}\n\t\t\t\t\t\tonChange={(e) => setSubject(e.currentTarget.value.length <= 16 ? e.currentTarget.value : subject)}\n\t\t\t\t\t/>\n\t\t\t\t</FormLayout>\n\t\t\t\t<FixedLayout vertical=\"bottom\" style={{ margin: 15, paddingRight: 30 }}>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tsize=\"xl\"\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tsetStatus(\"making\");\n\t\t\t\t\t\t\tgenerateStory(name, subject, (story) => {\n\t\t\t\t\t\t\t\tconnect.send(\"VKWebAppGetAuthToken\", { app_id: 6999640, scope: \"stories\"})\n\t\t\t\t\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\t\t\t\t\tconst access_token = response.data.access_token;\n\t\t\t\t\t\t\t\t\t\tconnect.send(\"VKWebAppCallAPIMethod\", {\n\t\t\t\t\t\t\t\t\t\t\tmethod: \"stories.getPhotoUploadServer\",\n\t\t\t\t\t\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\t\t\t\t\t\taccess_token,\n\t\t\t\t\t\t\t\t\t\t\t\tadd_to_news: 1,\n\t\t\t\t\t\t\t\t\t\t\t\tlink_text: \"open\",\n\t\t\t\t\t\t\t\t\t\t\t\tlink_url: \"https://vk.com/app6999640\",\n\t\t\t\t\t\t\t\t\t\t\t\tv: \"5.95\"\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst uploadUrl = response.data.response.upload_url;\n\n\t\t\t\t\t\t\t\t\t\t\t\tconst request = new FormData();\n\t\t\t\t\t\t\t\t\t\t\t\trequest.append(\"file\", dataURLtoFile(story, \"story.png\"));\n\n\t\t\t\t\t\t\t\t\t\t\t\tfetch(\"https://cors-anywhere.herokuapp.com/\" + uploadUrl, {\n\t\t\t\t\t\t\t\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tbody: request\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t.then(r => r.json())\n\t\t\t\t\t\t\t\t\t\t\t\t\t.then(r => r.error ? setStatus(\"error\") : setStatus(\"shared\"))\n\t\t\t\t\t\t\t\t\t\t\t\t\t.catch(console.error);\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t.catch(console.error)\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.catch(() => setStatus(\"sharingError\"));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\tПоделиться в истории\n\t\t\t\t\t</Button>\n\t\t\t\t</FixedLayout>\n\n\t\t\t\t<Group>\n            <Div>\n        Made by Nikitos\n           </Div>\n              </Group>\n\t\t\t</Panel>\n\t\t</View>\n\t);\n};\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport connect from '@vkontakte/vkui-connect-promise';\nimport App from './App';\n\nimport '@vkontakte/vkui/dist/vkui.css';\n\n// Init VK App\nconnect.send('VKWebAppInit', {});\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}